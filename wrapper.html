<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Consentua Web SDK Wrapper</title>

    <!-- consentua-embed.js is the only code that needs to be included by clients

    In production use: http://websdk.consentua.com/websdk/consentua-embed.js
-->
<script src="websdk/consentua-embed.js.php" type="text/javascript"></script>

<script
src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
crossorigin="anonymous"></script>


<style>
html {
    font-family: 'Open Sans', sans-serif;
    background: #fff;
}

body {
    max-width: 1200px;
    margin: 20px auto 20px auto;
}

main {
    display: flex;
}

form {
    width: 500px;
}

iframe {
    border: none;
    margin: 15px 0 15px 0;
}

pre {
    white-space: pre-wrap;
    background: #e3e3e3;
    margin-left: 1rem;
}

label {
    display: block;
    padding: 10px;
}

input[type="text"]
{
    display: block;
    width: 400px;
    font-size: 1.1em;
}

p
{
    color: #111;
    padding: 10px;
    margin: 10px;
}

.notice
{
    background: #ffedad;
    border: 1px solid #775f09;
}
</style>
</head>

<body>

<h1>Consentua Web SDK Demonstrator</h1>

<p>This page demonstrates how Consentua web components can be embedded into an HTML page to collect consent as part of an
    HTML form or other web flow.</p>

<p class="notice">The scripts in this example assume that jQuery is loaded, but jQuery is <strong>not</strong> a requirement
    for using Consentua.</p>

<main>

    <form>
        <h2>Example signup form with Consentua</h2>

        <label>Your name
        <input type="text" name="name" value="Joe Bloggs" /></label>

        <label>Email Address
        <input type="text" name="email" value="jbloggs@example.com" /></label>

        <!-- This iframe is the equivalent of the WebView in a native app, or iframe in a web app -->
        <iframe id="consentua-widget" src="" style="box-model: border-box; width: 100%; max-width: 500px;"></iframe>


        <p class="notice">The input below shows the user ID that consentua has generated for this user. This ID should be submitted and stored
        along with the rest of the form, so that up-to-date consent can be retrieved at any time. Normally, this input would be hidden.</p>
        <input type="text" disabled="dis" name="consentua-uid" id="consentua-uid" value="--not-set--" />


        <script>
        var cid = '2'; // Customer ID
        var sid = '1'; // Consentua service ID
        var skey = '19fb13ab-d6f2-42dc-a41c-42249450b5b6'; // Consentua service key
        var tid = '4'; // Template ID

        var uid = false;

        var cb_ready = function(msg) {
            $('#consentua-uid').val(msg.message.uid);
        }

        var cb_set = function (msg) {
            console.log("Consent received from Consentua", msg);

            if(msg.message.complete) {
                $('#signup-form input[type="submit"]').removeAttr('disabled', 'disabled');
            }
        };

        var iframe = document.getElementById('consentua-widget');
        var cwrap = new ConsentuaUIWrapper(iframe, cid, uid, tid, sid, skey);
        cwrap.onset = cb_set;
        cwrap.onready = cb_ready;

        // Disable submission on the form, until consent has been set
        $('#signup-form input[type="submit"]').attr('disabled', 'disabled');
        </script>
    </form>

    <pre>
        <code>
            &lt!-- It's common to embed consentua widgets into existing web forms, like in this example --&gt;
            &lt;form action="submit.php" method="post" id="signup-form"&gt;

            &lt;input type="text" name="name" value="" /&gt;
            &lt;input type="text" name="email" value="" /&gt;

            &lt!-- This iframe will hold the consentua interaction, it's populated by the script below --&gt;
            &lt;iframe id="consentua-widget" src="" style="box-model: border-box; width: 100%; max-width: 600px; min-height: 700px;"&gt;&lt;/iframe&gt;

            &lt!-- This hidden field will hold a UID, generated by consentua, so we can retrieve up-to-date consent details later on --&gt;
            &lt;input type="hidden" name="consentua-uid" id="consentua-uid" value="--not-set--" /&gt;

            &lt;input type="submit" value="Register"&gt;

            &lt;/form&gt;


            &lt;script&gt;


            var cid = '2'; // Customer ID
            var sid = '1'; // Consentua service ID
            var skey = '19fb13ab-d6f2-42dc-a41c-42249450b5b6'; // Consentua service key
            var tid = '4'; // Template ID

            /**
            * We need to identify who's using this interaction by providing a UserID. This could be
            * a customer number, for instance. If it's set to false, as in this example, then Consentua
            * will auto-generate a UserID that can be saved later - doing so is useful in situations
            * where we don't know the identity of a user in advance, like in a newsletter sign up
            * form.
            */
            var uid = false;

            /**
            * There are two event handlers that can be set up on the wrapper; one that's fired
            * when the consent interaction is ready (onready), and one that's fired every time
            * consent preferences are changed (onset)
            *
            * The main use for the onready event is to retrieve the auto-generated user id. If a user ID is
            * being passed explicitly to Consentua, then this isn't necessary.
            */
            var cb_ready = function(msg) {
                // We're using an auto-generated UID, so we need to store that somewhere! A common
                // approach is to store it in a hidden form field, using something like:
                $('#consentua-uid').val(msg.message.uid);
            }

            /**
            * The onset event includes current consent settings; you can use that information to
            * dynamically update the page; for instance by disabling form submission until certain
            * core purposes have been consented to.
            */
            var cb_set = function (msg) {
                console.log("Consent received from Consentua", msg);

                if(msg.message.complete) {
                    // Enable for submission once consent has been set for all purposes
                    // Some interactions will be 'complete' immediately (usually defaulting to false),
                    // but others require user interaction first.
                    $('#signup-form input[type="submit"]').removeAttr('disabled', 'disabled');
                }
            };

            var iframe = document.getElementById('consentua-widget');
            var cwrap = new ConsentuaUIWrapper(iframe, cid, uid, tid, sid, skey);
            cwrap.onset = cb_set;
            cwrap.onready = cb_ready;

            // Disable submission on the form, until consent has been set
            $('#signup-form input[type="submit"]').attr('disabled', 'disabled');

            &lt;/script&gt;
        </code>
    </pre>

</main>
</body>
</html>
